{"file_name": "docs/profiles/profile_merging.md", "questions": ["- How does profile merging work?", "- What is the role of identity resolution in a customer data platform?", "- How does the merging process handle conflicting data?", "- What is profile propagation and how does it ensure a unified customer view across devices?", "- Why is it important to synchronize the profile ID saved on the client side with the one returned in the response?"], "answer": "# Profile merging and Identity resolution\n## Profile Merging\n\nProfile merging is the process of bringing together multiple customer profiles that belong to the same person but have\nbeen stored separately for various reasons, like using different devices or email addresses. To create a complete\nprofile, a unique merging key is chosen to combine the data across the entire system. This merging key can be an email\naddress, credit card, or any other identifier that groups client profiles.\n\n**Example:** Imagine a customer, John, uses his laptop with Firefox and gets profile ID 1. When he uses Google Chrome on\nthe same laptop, he gets profile ID 2. Then, when he uses his mobile phone, he gets profile ID 3. Although all these\nprofiles represent John, they have different data. For instance, profile ID 1 may have purchase data but not his name,\nwhich is saved in profile ID 2. By merging these profiles, we can have a complete understanding of John as a customer.\n\n## Identity Resolution\n\nIdentity resolution is a broader term used to link various pieces of data about an individual or entity to create a\ncomprehensive and accurate view. In a customer data platform (CDP), identity resolution helps connect data from\ndifferent sources, like website interactions and email campaigns, to form a unified customer profile.\n\n## Merging Process\n\nMerging customer profiles is a complex process that involves following rules and procedures. It starts by retrieving the\ncurrent customer profile from the database. If the event is handled by a workflow with the profile merging action or is\nmarked as an identification point in the customer journey, the system uses the defined \"merge key\" (like an email\naddress) to load the profile data instead of the profile's ID.\n\nIf the system finds multiple profiles with the same merge key, it merges the data from all these profiles into one. In\ncase of conflicting data, like different names, the system resolves the conflict by picking the last value and saving\nother values in an \"aux.conflict.name\" field, like [\"Bill\", \"William\"].\n\nThe merged profile receives a new ID, and a new profile record is created. Obsolete profiles are deleted, and the events\nassociated with the deleted profiles are copied to the new merged profile.\n\nThe new profile ID is saved locally on the device's database using JavaScript. However, it's important to note that not\nall devices may update their reference to the current profile with the new ID immediately.\n\n## Profile Propagation\n\nConsider this example: A customer uses an online store with a laptop and a mobile phone, and each device has a different\nprofile ID. The laptop has profile ID 1, and the mobile phone has profile ID 2.\n\nAt some point, the customer enters their email address on the laptop, creating a new merged profile with ID 3. The\nlaptop's browser saves a reference to this new profile. However, the mobile phone still stores the reference to the old\nprofile.\n\nThe next time the customer uses their mobile phone to access the online store, the system uses the old profile ID to\nidentify them. But instead of loading the old profile, the system recognizes that the old profile ID has been merged\nwith a new profile. The mobile phone receives the new profile ID (3) and saves it locally.\n\nThis way, the linked profile information propagates to all devices, and the customer will have the same updated profile\nID on both the laptop and the mobile phone. This provides a complete customer view and improves the overall customer\nexperience.\n\n!!! Note\n\n    It is **very important** to synchronize `profile.id` returned in response with the profile ID saved on a client side.\n    If the profile in the response is different from the one sent, it means the client should update its `profile.id` \n    and send the new one with the next call. Missing this step may cause the `profile.id` to be recreated with each \n    call to the /track API, potentially causing issues with the customer's profile.\n", "hash": "9f6e1fcef377069ce0fbc09a03f355992b49562e"}